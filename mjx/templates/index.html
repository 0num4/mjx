<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="static/css/style.css" rel="stylesheet">
  <title>Mjx Visualizer</title>
</head>

<body style="display: block; text-align: center;">

  <div class="main">
    <div class="left">
      <span id="svg">{{ svg | safe }}</span>
    </div>
    <div class="right">
      {% if choices|length > 0 %}
      {% if choices[0]["type"]=="ダミー" %}
      <form action="/" method="POST" enctype="multipart/form-data">
        {% for choice in choices %}
        <button type="submit" name="choice" value=0>
          次へ
        </button>
        {% endfor %}
      </form>
      {% else %}
      <form action="/" method="POST" enctype="multipart/form-data">
        {% for choice in choices %}
        {% if loop.index0 == 0 %}
        <button autofocus id={{"button"+ loop.index0|string }} type="submit" name="choice" value={{ choice["index"] }}>
        {% else %}
        <button id={{"button"+ loop.index0|string }} type="submit" name="choice" value={{ choice["index"] }}>
        {% endif %}
          <span>{{choice["type"]}}</span>
          {% if choice["red"] %}
          <span class="MJFontR">{{choice["char"]}}</span>
          {% else %}
          <span class="MJFont">{{choice["char"]}}</span>
          {% endif %}
        </button>
        {% endfor %}
      </form>
      {% endif %}
      {% endif %}
    </div>
  </div>

  <script>
    var idx = 0;
    var keydown_counters = [0, 0]
    function focus_back() {
      idx = (idx + {{ choices | length | tojson }} -1)% {{ choices | length | tojson }};
      document.getElementById("button" + idx).focus();
    };
    function focus_forward() {
      idx = (idx + 1) % {{ choices | length | tojson }};
      document.getElementById("button" + idx).focus();
    };

    document.body.addEventListener('keydown',
      event => {
        switch (event.key) {
          case 'ArrowUp':
          case 'ArrowLeft':
          case 'j':
            keydown_counters[0]++;
            if (keydown_counters[0] == 1) { focus_back(); }
            break;
          case 'ArrowDown':
          case 'ArrowRight':
          case 'k':
            keydown_counters[1]++;
            if (keydown_counters[1] == 1) { focus_forward(); }
            break;
        }
      });
    
    document.body.addEventListener('keyup',
      event => {
        switch (event.key) {
          case 'ArrowUp':
          case 'ArrowLeft':
          case 'j':
            keydown_counters[0]=0;
            break;
          case 'ArrowDown':
          case 'ArrowRight':
          case 'k':
            keydown_counters[1]=0;
            break;
        }
      });
  </script>
</body>

</html>